<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inven.tree.mapper.ProductsMapper">
    <!-- Result Map -->
    <resultMap id="productsResultMap" type="com.inven.tree.model.Products">
        <id property="prodIdx" column="prod_idx" />
        <result property="prodName" column="prod_name" />
        <result property="prodInfo" column="prod_info" />
        <result property="prodBarcode" column="prod_barcode" />
        <result property="prodCnt" column="prod_cnt" />
        <result property="prodMake" column="prod_make" />
        <result property="createdAt" column="created_at" />
        <result property="corpIdx" column="corp_idx" />
       <!-- 재고현황때문에 필드 3개 추가했음 -->
        <result property="shelfIdx" column="shelf_idx"/>
        <result property="rackId" column="rack_id"/>
        <result property="whIdx" column="wh_idx"/>
    </resultMap>


   

    <!-- 회사명으로 회사인덱스 추출 -->
    <select id="selectCorpIdxByName" parameterType="string" resultType="string">
        SELECT corp_idx FROM corporations WHERE corp_name = #{corpName}
    </select>

    <!-- 상품바코드로 상품인덱스 추출 -->
    <select id="selectProdIdxByBarcode" parameterType="string" resultType="int">
        SELECT prod_idx FROM products WHERE prod_barcode = #{prodBarcode}
    </select>

    <!-- 입고 등록 insert 메소드 -->
    <insert id="insertStock">
        INSERT INTO stocks (corp_idx, prod_idx, stock_cnt, stocked_at, sub_idx)
        VALUES (#{corpIdx}, #{prodIdx}, #{prodCnt}, #{stockedAt}, #{subIdx})
    </insert>

    <!-- 재고 수량 수정 메소드 -->
    <update id="updateProductCount">
        UPDATE products SET prod_cnt = prod_cnt + #{prodCnt} WHERE prod_idx = #{prodIdx}
    </update>

    <!-- 모든 상품정보 가져오는 메소드 (회사코드 상관 없이) -->
    <select id="selectAllProducts" resultMap="productsResultMap">
        SELECT * FROM products
    </select>
	
	
	
	<!-- 재고현황으로 인해 새로 추가된 메소드들  -->
    <select id="selectProductsByCorpIdx" resultType="com.inven.tree.model.Products">
    SELECT * FROM products WHERE corp_idx = #{corpIdx}
</select>

<select id="existsByProdBarcode" resultType="boolean">
    SELECT COUNT(*) > 0 FROM products WHERE prod_barcode = #{prodBarcode}
</select>

<update id="updateProduct" parameterType="com.inven.tree.model.Products">
    UPDATE products
    SET prod_name = #{prodName}, prod_cnt = #{prodCnt}, wh_idx = #{whIdx}, 
        shelf_idx = #{shelfIdx}, prod_info = #{prodInfo}
    WHERE prod_barcode = #{prodBarcode}
</update>

<insert id="insertProduct" parameterType="com.inven.tree.model.Products">
    INSERT INTO products (prod_barcode, prod_name, prod_cnt, wh_idx, shelf_idx, prod_info, corp_idx)
    VALUES (#{prodBarcode}, #{prodName}, #{prodCnt}, #{whIdx}, #{shelfIdx}, #{prodInfo}, #{corpIdx})
</insert>

<delete id="deleteProductByBarcode" parameterType="string">
    DELETE FROM products WHERE prod_barcode = #{prodBarcode}
</delete>
</mapper>
